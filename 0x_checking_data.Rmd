---
title: "R for Actuaries - Part X"
subtitle: "Checking and Exploring Data"
author: "Mick Cooney <mcooney@agrippadataconsulting.com>"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    number_sections: true
    fig_caption: yes
    theme: cerulean
  pdf_document: default
---

```{r set_options, echo=FALSE}
options(width = 80L
       ,warn  = 1)

knitr::opts_chunk$set(tidy  = FALSE
                     ,cache = FALSE
                     ,fig.height =  7
                     ,fig.width  = 11)
```


# Checking and Exploring Data

In this exercise we are going to build claims triangles from transactional claim
data. The claims are from a fictional captive insurer for a large logistics
company with operations all across Europe.

The data has been provided to us in multiple files, with each file sorted
according to country. The data is current as of date 30 June 2017.

Reading data from a file is an important topic, but is not a good place to
start learning: 80% of the time it is routine and boring, the other 20% of the
time it is fiddly and frustrating! We will return to it later.

For now, we have a script that loads the table `claims_transactions_tbl` into
memory.

```{r load_data, echo=TRUE, message=FALSE}
source('load_data_script.R')
```

## Claims Transactions Data

THe first thing to do with a dataset is inspect it: look at the first few rows,
check the number of rows and columns, and check the data types.

```{r inspect_claims_transactions, echo=TRUE}
print(claims_transactions_tbl)

glimpse(claims_transactions_tbl)
```

The data types that have been loaded seem appropriate.


## Basic Data Manipulation

We first want to learn how to perform basic manipulation - taking subsets of
rows and columns through the `dplyr` package.

### Subsetting Rows and Columns

In the `dplyr` lexicon, we `select()` columns and `filter()` rows. We start by
subsetting only the claims for Ireland (IRL).

```{r filter_irl_rows, echo=TRUE}
irl_data_tbl <- claims_transactions_tbl %>%
    filter(country_code == 'IRL') %>%
    select(country_code, year, claim_id, transaction_date, claim_type, amount)

glimpse(irl_data_tbl)
```

If we put a `-` symbol in front of column names, we exclude those instead.

```{r filter_irl_rows_removal, echo=TRUE}
irl_data_tbl <- claims_transactions_tbl %>% 
    filter(country_code == 'IRL') %>%
    select(-incident_date, -report_date)

glimpse(irl_data_tbl)
```

We can have multiple conditions at once in a `filter()` condition:

```{r filter_irl_2015_data, echo=TRUE}
irl_2015_data_tbl <- claims_transactions_tbl %>% 
    filter(country_code == 'IRL'
          ,year         == 2015
           ) %>%
    select(-incident_date, -report_date)

glimpse(irl_2015_data_tbl)
```


#### Exercises






